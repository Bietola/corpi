#!/usr/bin/env stack
{- stack script
    --resolver lts-17.10
    --package turtle
    --package text
    --package monadlist
    --package foldl
    --package lens-regex-pcre
    --package lens
-}

{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes #-}


import Prelude hiding (tail, head)
import qualified Data.List as L
import Data.Functor
import Control.Lens.Operators
import qualified Control.Lens.Regex.Text as R
import Control.Lens.Regex.Text (regex)
import qualified Control.Foldl as Fl
import qualified Data.Text as T
import qualified Data.Text.IO as T

import Turtle hiding ((<&>), match)
import qualified Turtle.Pattern as ShP

tail n shl =
    reduce Fl.list shl >>= select . drop n

bannerLength = 17

main = view $ let
    -- Remove Banner
    nobanner = drop bannerLength <$> reduce Fl.list stdin

    -- Remove newlines
    -- oneline = return @Shell "<esc>dfgxajdhei<esc>hsAjk"
    oneline = lineToText . mconcat <$> nobanner

    -- Add buffer control seq.s
    -- in has [regex|whisk|] . match "whiskers on kittens"
    -- in return ("<s-A><s-d><c-d>jdiso<esc><s-d>" & [regex|<(s)-.*?>|] . R.group 0 .~ "SHIFT")
    in oneline <&> [regex|<esc>.*?[iIaAoO]|] . R.match <>~ "<wbf>"
